<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Building reproducible analytical pipelines with R - 11&nbsp; Packaging your code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./testing.html" rel="next">
<link href="./repro_intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script data-goatcounter="https://brodriguesco.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
<noscript>
    </noscript></head><body class="nav-sidebar floating"><img src="https://brodriguesco.goatcounter.com/count?p=/test-noscript">



<link rel="stylesheet" href="epub.css">




<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2_intro.html">Part 2: Write IT down</a></li><li class="breadcrumb-item"><a href="./packages.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Packaging your code</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Building reproducible analytical pipelines with R</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 1: Don’t Repeat Yourself</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prerequisites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Before we start</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project_start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Project start</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Version control with Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Collaborating using Trunk-based development with Github</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fprog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Functional programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lit_prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Literate programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conclusion of part 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part2_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 2: Write IT down</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project_rewrite.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Rewriting our project</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repro_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Basic reproducibility: freezing packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Packaging your code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Testing your code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./targets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Build automation with targets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repro_cont.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Reproducible analytical pipelines with Docker</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ci_cd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Continuous integration and continuous deployment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Conclusion of part 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./book_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">“So what?”</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#benefits-of-packages" id="toc-benefits-of-packages" class="nav-link active" data-scroll-target="#benefits-of-packages"><span class="header-section-number">11.1</span> Benefits of packages</a></li>
  <li><a href="#fusen-quickstart" id="toc-fusen-quickstart" class="nav-link" data-scroll-target="#fusen-quickstart"><span class="header-section-number">11.2</span> <code>{fusen}</code> quickstart</a></li>
  <li><a href="#turning-our-rmds-into-a-package" id="toc-turning-our-rmds-into-a-package" class="nav-link" data-scroll-target="#turning-our-rmds-into-a-package"><span class="header-section-number">11.3</span> Turning our Rmds into a package</a></li>
  <li><a href="#including-datasets" id="toc-including-datasets" class="nav-link" data-scroll-target="#including-datasets"><span class="header-section-number">11.4</span> Including datasets</a></li>
  <li><a href="#installing-and-sharing-the-package" id="toc-installing-and-sharing-the-package" class="nav-link" data-scroll-target="#installing-and-sharing-the-package"><span class="header-section-number">11.5</span> Installing and sharing the package</a>
  <ul class="collapse">
  <li><a href="#code-is-hosted" id="toc-code-is-hosted" class="nav-link" data-scroll-target="#code-is-hosted"><span class="header-section-number">11.5.1</span> Code is hosted</a></li>
  <li><a href="#code-cannot-be-hosted" id="toc-code-cannot-be-hosted" class="nav-link" data-scroll-target="#code-cannot-be-hosted"><span class="header-section-number">11.5.2</span> Code cannot be hosted</a></li>
  <li><a href="#marketing-your-work" id="toc-marketing-your-work" class="nav-link" data-scroll-target="#marketing-your-work"><span class="header-section-number">11.5.3</span> Marketing your work</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">11.6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Packaging your code</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, you’re going to learn how to create your own package. And let me be clear right from the start: the goal here is not to convert your analysis as a package to then get it published on CRAN. No, that’s not it. The goal is to convert your analysis into a package because when your analysis goes into <em>package development mode</em>, you can, as the developer, leverage many tools that will help you improve the quality of your analysis. These tools will make it easier for you to:</p>
<ul>
<li>document the functions you had to write for your analysis;</li>
<li>test these functions;</li>
<li>properly define dependencies;</li>
<li>use all the code you wrote into a true reproducible pipeline.</li>
</ul>
<p>Turning the analysis into a package will also make the separation between the software development work you had to write for your analysis (writing functions to clean data for instance) from the analysis itself much clearer. The package itself can be published on Github (if there’s nothing particularly sensitive about it) and can also be very easily installed from R itself from Github, or you can store it inside your organisation and then simply install it locally.</p>
<p>By turning your analysis into a package you will essentially end up with two <em>things</em>:</p>
<ul>
<li>a well-documented, and tested package;</li>
<li>an analysis that uses this package like any other package.</li>
</ul>
<p>Making this separation will then make it easier to record dependencies of your analysis using <code>{renv}</code>, as your package will be a package like any other that needs to be recorded. And what’s more, we can start with the <code>.Rmd</code> files that we have already written! The <code>{fusen}</code> package will bridge the gap between the <code>.Rmd</code> files and the package: as Sébastien Rochette, the author of <code>{fusen}</code>, says:</p>
<blockquote class="blockquote">
<p>If you have written an Rmd file, you have (almost) already written a package.</p>
</blockquote>
<section id="benefits-of-packages" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="benefits-of-packages"><span class="header-section-number">11.1</span> Benefits of packages</h2>
<p>Let’s first go over the benefits of turning your analysis into a package once again, as this is crucial.</p>
<p>The main point is not to turn the analysis into a package to publish on CRAN (but you can if you want to). The point is that when you analyse data, more often than not you have to write a lot of custom code, and very often, you don’t expect to write that much custom code. Let’s think about our little project: all we wanted was to create some plots from Luxembourguish houses’ price data. And yet, we had to scrape Wikipedia on two occasions, clean an Excel file, and write a test… the project was quite modest, and yet, the amount of code (and thus opportunities to make mistakes) is quite large. But, that’s not something that we could have anticipated, hence why we never really start by writing a package, but a script (or rather, an <code>.Rmd</code>) instead. But then as this script grows larger and larger, we realise that we might need something else than a simple <code>.Rmd</code> file.</p>
<p>The other benefit of turning all this code into a package is that we get a clear separation between the code that we wrote purely to get our analysis going (what I called the <em>software development part</em> before) from the analysis itself (which would then typically consist in computing descriptive statistics, running regression or machine learning models, and visualisation). This then in turn means that we can more easily maintain and update each part separately. So the pure software development part goes into the package, which then gives us the possibility to use many great tools to ensure that our code is properly documented and tested, and then the analysis can go inside a purely reproducible pipeline.</p>
</section>
<section id="fusen-quickstart" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="fusen-quickstart"><span class="header-section-number">11.2</span> <code>{fusen}</code> quickstart</h2>
<p>If you haven’t already, install the <code>{fusen}</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"fusen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>{fusen}</code> makes the <em>documentation first</em> method proposed by Sébastien Rochette, <code>{fusen}</code>’s author, a reality. The idea is to start from documentation in the form of an <code>.Rmd</code> file and go from there to a package. Let’s dive right into it by starting from a template included in the <code>{fusen}</code> package. Start an R session from your home (or Documents) directory and run the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fusen<span class="sc">::</span><span class="fu">create_fusen</span>(<span class="at">path =</span> <span class="st">"fusen.quickstart"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">template =</span> <span class="st">"minimal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will create a directory called <code>fusen.quickstart</code> inside your home (or Documents) directory. Inside that folder, you will find another folder called <code>dev/</code>. Let’s see what’s inside (I use the command line to list the files, but you’re free to use your file explorer program):</p>
<pre><code>owner@localhost ➤ ls dev/

0-dev_history.Rmd  flat_minimal.Rmd</code></pre>
<p><code>dev/</code> contains two <code>.Rmd</code> files, <code>0-dev_history.Rmd</code> and <code>flat_miminal.Rmd</code>. They’re both important, so let me explain what they do:</p>
<ul>
<li><code>flat_minimal.Rmd</code> is only an example, a stand-in for our own <code>.Rmd</code> files. When doing actual work, we will be using the Rmd file(s) that we have written before (<code>analyse_data.Rmd</code> and <code>save_data.Rmd</code>) instead.</li>
<li><code>0-dev_history.Rmd</code> contains lines of code that you typically run when you’re developing a package. For example, a line to initialise Git for the project, a line to add some dependencies, etc, etc. The idea is to <strong>write down everything</strong> that you type in the console in this file. This leaves a trace of what you have been doing, and also acts as a checklist so that you can make sure that you didn’t forget anything.</li>
</ul>
<p>Before describing these files in detail, I want to show you this image taken from <code>{fusen}</code>’s <a href="https://thinkr-open.github.io/fusen/">website</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<figure class="figure">
<img src="images/fusen_inflate_functions.png" alt="fusen takes care of the boring stuff for you!" class="figure-img">
<figcaption class="figure-caption">
fusen takes care of the boring stuff for you!
</figcaption>
</figure>
<p>On the left-hand side of the image, we see the two template <code>.Rmd</code> files from <code>{fusen}</code>. <code>0-dev_history.Rmd</code> contains a chunk called <code>description</code>. This is the main chunk in that file that we need to execute to get started with <code>{fusen}</code>. Running this chunk will create the package’s <code>DESCRIPTION</code> file (don’t worry if you don’t know about this file yet, I will explain). Then, the second file <code>flat_minimal.Rmd</code> (or our very own <code>.Rmd</code> files) contain functions, tests, examples, and everything we need for our analysis. When we <em>inflate</em> the Rmd file, <code>{fusen}</code> places every piece from this <code>.Rmd</code> file in the right place: the functions get copied into the package’s <code>R/</code> folder, tests go into the <code>tests/</code> folder, and so on. <code>{fusen}</code> simply takes care of everything for us!</p>
<p>But, for <code>{fusen}</code> to be able to work its magic, we do need to prepare our <code>.Rmd</code> file a bit. But don’t worry, it is mostly simply giving adequate names to our code chunks. Let’s take a look at the <code>flat_minimal.Rmd</code> file that was just generated. If you open it in a text editor, you should see that it is a fairly normal <code>.Rmd</code> file. There is a comment telling you to first run the <code>description</code> chunk in the <code>0-dev_history.Rmd</code> file before changing this one. But let’s keep reading <code>flat_minimal.Rmd</code>. What’s important comes next:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a># my_fun</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>```{r function-my_fun}</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>#' my_fun Title</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>#'</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>#' @return 1</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>#' @export</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>#'</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>#' @examples</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>my_fun &lt;- function() {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  1</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>```{r examples-my_fun}</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>my_fun()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>```{r tests-my_fun}</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>test_that("my_fun works", {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is a section titled <code>my_fun</code>. Then comes the definition of <code>my_fun()</code>, inside a chunk titled <code>function-my_fun</code>, then comes an example, inside a chunk titled <code>examples-my_fun</code> and finally a test in a chunk titled <code>tests-my_fun</code>.</p>
<p>This is essentially how we need to rewrite our own <code>.Rmd</code> files to be able to use <code>{fusen}</code>. What’s really nice, is that most of it is actually done already. Using <code>{fusen}</code> just <em>forces</em> us to clean up our code and define examples and tests (if we want them) more cleanly and explicitly. Also, you might have noticed that in the chunk with the function definition there are a bunch of comments that start with <code>#'</code>. These are <code>{roxygen2}</code> type comments. As the package’s documentation gets built, these comments get automatically turned into the documentation you see when you type <code>help(my_fun)</code> in an R console.</p>
<p>So, basically, a <code>{fusen}</code>-ready <code>.Rmd</code> file is nothing more than an <code>.Rmd</code> file with some structure imposed on it. Instead of documenting your functions as simple comments, document them using <code>{roxygen2}</code> comments, which then get turned into the package’s documentation automatically. Instead of writing ad-hoc tests, or worse, instead of testing your functions on your console only, and manually one by one (and we’ve all done this), write down the test inside the <code>.Rmd</code> file itself, right next to the function you’re testing. Instead of trying your function out on some mock data in your console, write down that example inside the <code>.Rmd</code> file itself.</p>
<p><strong>Write it down</strong>, <strong>write it down</strong>, <strong>write it down</strong>… you’re already documenting and testing things, so why not just write it down once and for all, so you don’t have to rely on your ageing, mushy brain so much? Don’t make yourself remember things, just write them down! <code>{fusen}</code> gives you a perfect framework to do this. The added benefit is that it will improve your package’s quality through the tests and examples that are not directly part of the analysis itself but are still required to make sure that the analysis is of high quality. So if you start messing with your functions, you have the tests right there to tell you if you introduced breaking changes.</p>
<p>Let’s go back to the template and inflate it into a package. Open <code>0-dev_history.Rmd</code> and take a look at the <code>description</code> code chunk:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>```{r description, eval=FALSE}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a># Describe your package</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fusen::fill_description(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  pkg = here::here(),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  fields = list(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    Title = "Build A Package From Rmarkdown File",</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    Description = "Use Rmarkdown First method to build your package.</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                   Start your package with documentation.</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                   Everything can be set from a Rmarkdown file</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                   in your project.",</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    `Authors@R` = c(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      person("Sebastien", "Rochette", email = "sebastien@thinkr.fr",</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>             role = c("aut", "cre"),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>             comment = c(ORCID = "0000-0002-1565-9313")),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      person(given = "ThinkR", role = "cph")</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a># Define License with use_*_license()</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>usethis::use_mit_license("Sébastien Rochette")</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Running this chunk will create the package’s <code>DESCRIPTION</code> file. <a href="https://raw.githubusercontent.com/b-rodrigues/chronicler/c34239d0d42a4ad6082dff614fc6b4c0e9b917d8/DESCRIPTION">Here</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> is an example of such a file. This file provides some information on who wrote the package, the purpose of the package, as well as some metadata such as the package’s version. What’s also quite important are the packages listed below the keywords <code>Depends:</code>, <code>Imports:</code> and <code>Suggests:</code>. <code>Depends:</code> is where you list packages (or R versions) that must be installed for your package to work (if they’re not installed, they will be installed alongside your package). This is the same with <code>Imports:</code>, and the difference with <code>Depends:</code> is most of the time irrelevant: packages listed under <code>Depends</code> will not only be loaded when you load your package, but also attached. This means that the functions from these packages will also be available to the end-user when loading your package. Packages listed under <code>Imports:</code> will only be loaded, meaning that their functions will only be available to your packages’ functions, not the end-users themselves. If that’s confusing, don’t worry too much about it. Finally, <code>Suggests:</code> are dependencies that are not critical, usually these are only necessary if you want to run the code from the packages vignettes or examples. As you can imagine, listing the right packages under the right category can be a daunting task. But don’t worry, <code>{fusen}</code> takes care of this automatically for us! Simply focus on writing your <code>.Rmd</code> files.</p>
<p>The last line of this chunk runs <code>usethis::use_mit_license()</code>. <code>{usethis}</code> is a package that contains many helper functions to help you develop packages. You can choose among many licenses, but this is only relevant if you want to publish your package on CRAN, and you don’t need to think too much about it at the start, since you can always change the license later. And if you don’t want to publish your package anywhere (nor CRAN, nor Github) and keep it completely internal to your organisation, you don’t need to think about it at all. My very personal take on licenses is that you should use copyleft licenses as much as possible (so licenses like the GPL) which ensure that if someone takes your code and changes it, their changes also have to be republished to the public under the GPL – but only if they wish to publish their changes. They could always keep their modifications totally private, which means that companies can, and do, use GPL’ed code in their internal products.</p>
<p>It’s when that product gets released to the public, that the source code must be released as well. This ensures that open code stays open.</p>
<p>However, licenses like the MIT allow private companies to take open source and freely available code and incorporate it inside their own proprietary tools, without having to give back their modifications to the community. Some people argue that this is the <em>true</em> free license, because anyone is then also free to use any code and they also have the liberty of not having to give anything back to the community. I think that this is a very idiotic argument, and when proponents of permissive licenses like the MIT (or BSD) get their code taken and not even thanked for it (as per the license, which doesn’t even force anyone to cite the software), and their software gets used for nefarious purposes, <a href="https://web.archive.org/web/20230223092823/https://www.cs.vu.nl/~ast/intel/">the levels of cope are through the roof</a><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> (archived link for posterity). Anyway, I got side-tracked here, let’s go back to our package.</p>
<p>Run the code inside the description chunk in an R console (don’t change anything for now, and make sure that the R session was started on the root of the project, so in the <code>fusen.quickstart/</code> folder), and see the <code>DESCRIPTION</code> file appear magically in the root of the folder (as well as the <code>LICENSE</code> file, containing the license).</p>
<p>For now, we can ignore the rest of the <code>0-dev_history.Rmd</code> file: actually, everything that follows is totally optional, but still useful. If you look at them, you see that lines that follow simply help you remember to do useful things, like initialising Git, creating a <code>Readme</code> file, add some usual dependencies, as so one. But let’s ignore this for now, and go to the <code>flat_minimal.Rmd</code> file.</p>
<p>Got at the end of the file, and take a look at the chunk titled <code>development-inflate</code>. This is the chunk that will convert the <code>.Rmd</code> file into a fully functioning package. This process is called <em>inflating</em> the <code>.Rmd</code> file (because a <em>fusen</em> is a type of origami figure that you fold in a certain way, which can then get <em>literally</em> inflated into a box). Run the code in that chunk, and see your analysis become a package automagically.</p>
<p>If you look now at the projects’ folder, you will see several new sub-folder:</p>
<ul>
<li><code>R/</code>: the folder that contains the functions;</li>
<li><code>man/</code>: contains the functions’ documentation;</li>
<li><code>tests/</code>: contains the tests;</li>
<li><code>vignettes/</code>: contains the vignettes.</li>
</ul>
<p>Every function defined in the <code>flat_minimal.Rmd</code> file is now inside the <code>R/</code> folder; all the documentation written as <code>{roxygen2}</code> comments is now neatly inside <code>man/</code>, the tests are in <code>tests/</code>, and <code>flat_minimal.Rmd</code> has been converted to an actual vignette (without all the <code>development</code> chunks). This is now a package that can be installed immediately using <code>devtools::install()</code>, or that can be shared on Github and installed from there. Right now, without doing anything else. You can even generate a website for your package: got back to the <code>0-dev_history.Rmd</code> and check the last code chunk, under the title <em>Share the package</em>. Start a new, fresh session at the root of your project and run the two following lines from that last chunk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set and try pkgdown documentation website</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pkgdown</span>()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>pkgdown<span class="sc">::</span><span class="fu">build_site</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will build a website for your package and open your web browser and show you how it looks like. The files for this website are in the newly created <code>docs/</code> folder in the root of your package folder. This can then be hosted, for free, with Github so people can explore the package’s functions and documentation without having to install the package!</p>
</section>
<section id="turning-our-rmds-into-a-package" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="turning-our-rmds-into-a-package"><span class="header-section-number">11.3</span> Turning our Rmds into a package</h2>
<p>Ok, so I hope to have convinced you that <code>{fusen}</code> is definitely something that you should add to your toolbox. Let’s now turn our analysis into a package, but before diving right into it, let’s think about it for a moment.</p>
<p>We have two <code>.Rmd</code> files, one for getting and cleaning the data, which we called <code>save_data.Rmd</code> and another for analysing this data, called <code>analyse_data.Rmd</code>.</p>
<p>In both <code>.Rmd</code> files, we defined a bunch of functions, but most of the functions were defined in the <code>save_data.Rmd</code> script. In fact, in the <code>analyse_data.Rmd</code> file we defined only two functions, <code>get_laspeyeres()</code>, the function to get the Laspeyeres price index, and <code>make_plot()</code>, the function to create the plots for our analysis.</p>
<p>We are faced with the following choice here:</p>
<ul>
<li>make both these <code>.Rmd</code> files <em>fusen-ready</em>, and inflate them both. This would put the functions from both <code>save_data.Rmd</code> and <code>analyse_data.Rmd</code> into the inflated package <code>R/</code> folder;</li>
<li>put all the functions into <code>save_data.Rmd</code> and only inflate that file. The other, <code>analyse_data.Rmd</code> can then be used exclusively for the analysis <em>stricto sensu</em>.</li>
</ul>
<p>This is really up to you, there is no right or wrong answer. You could even go for another option if you wanted. It all depends on how much time you want to invest into this. If you want to get done quickly, the first option, where you simply inflate both files is the fastest. If you have more time, the last option, where you neatly split everything might be better. I propose that we go for the second option. This way, we only have to inflate one file, and in our case here, it won’t take much time anyways. It’s literally only moving two code chunks from <code>analyse_data.Rmd</code> to <code>save_data.Rmd</code>. So before continuing, let’s go back to our repository and switch back to the <code>rmd</code> branch that contains the <code>.Rmd</code> files (let’s ignore freezing packages with <code>{renv}</code> and thus the <code>renv</code> branch for now):</p>
<pre><code>owner@localhost ➤ git checkout rmd</code></pre>
<p>From, there, let’s create a new branch called <code>fusen</code>:</p>
<pre><code>owner@localhost ➤ git checkout -b fusen</code></pre>
<pre><code>Switched to a new branch 'fusen'</code></pre>
<p>We will now be working on this branch. Simply work as usual, but when pushing, make sure to push to the <code>fusen</code> branch:</p>
<pre><code>owner@localhost ➤ git add .
owner@localhost ➤ git commit -am "some changes"
owner@localhost ➤ git push origin fusen</code></pre>
<p>By now, that repository should have four branches:</p>
<ul>
<li><em>master</em>, or <em>main</em> with the simple <code>.R</code> scripts;</li>
<li><em>rmd</em>, with the <code>.Rmd</code> files</li>
<li><em>renv</em>, containing the <code>.Rmd</code> files as well, and the <code>renv.lock</code> file</li>
<li><em>fusen</em>, the branch we will be using now.</li>
</ul>
<p>If you’ve skipped the first part of the book, or didn’t diligently create the branches and push, you can fork this <a href="https://github.com/b-rodrigues/housing">repository</a><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> and then clone it to start from a sane base. Switch to the <code>rmd</code> branch, and create a branch called <code>fusen</code>.</p>
<p>First order of business: create a <code>{fusen}</code> template in the folder. Start a fresh R session inside the <code>housing/</code> folder, and run the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fusen<span class="sc">::</span><span class="fu">create_fusen</span>(<span class="at">path =</span> <span class="st">"."</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">template =</span> <span class="st">"minimal"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because we already have a folder for our project, called <code>housing/</code> we use the <code>"."</code> which essentially means “right here”. We need the <code>overwrite = TRUE</code> option because the folder exists already. Running the above command will add the <code>dev/</code> folder. Move <code>save_data.Rmd</code> inside; remember, we only want to inflate that one: <code>analyse_data.Rmd</code> will be a simple <code>.Rmd</code> that will use our package to load the needed functions and data.</p>
<p>Next step, move the functions <code>get_laspeyeres()</code> and <code>make_plot()</code> from <code>analyse_data.Rmd</code> to <code>save_data.Rmd</code>. Simple cut and paste these functions from one <code>.Rmd</code> to the other. Make sure <code>save_data.Rmd</code> looks something like <a href="https://gist.github.com/b-rodrigues/16952727d35355bf3b9cbd5f37843c20">this</a><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, take a look at the end of the script to find the functions we’ve moved over. The <code>analyse_data.Rmd</code> script is exactly the same, minus the functions that we’ve just moved over.</p>
<p>Ok, so now, we need to make <code>save_data.Rmd</code> ready to be inflated. Take inspiration from the <code>flat_minimal.Rmd</code> that <code>fusen::create_fusen()</code> put in the <code>dev/</code> folder. This is what the end-result should <a href="https://is.gd/anRjt4">look like</a> (no worries, I’m going to explain how I got there).</p>
<p>Let’s start by the first function, <code>get_raw_data()</code>. If you compare the <a href="https://gist.github.com/b-rodrigues/16952727d35355bf3b9cbd5f37843c20">before</a><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> and <a href="https://is.gd/anRjt4">after</a>, the differences are that we have named the chunk <code>function-get_raw_data</code> and added documentation in the form of <code>{roxygen2}</code> comments. Naming the chunks is essential: this is how <code>{fusen}</code> knows that this chunk contains a function that should go into the <code>R/</code> folder. <code>{roxygen2}</code> are strictly speaking not required, but it is highly advised that you add them: this way, your function will get documented and users (including future you) will be able to read the documentation by typing <code>help(get_raw_data)</code>. Another difference is that I have made all the functions referentially transparent. Take a closer look at <code>make_plot()</code> in the before and after <code>.Rmd</code>’s. You will see that I’ve added two arguments to <code>make_plot()</code>, <code>country_level_data</code> and <code>commune_level_data</code>. This is really important, so don’t forget to do it!</p>
<p>Remember when I mentioned that the good thing about turning our analysis into a package is that it gives us a framework to develop high quality code by using nice development tools? <code>{roxygen2}</code> type comments for documentation is the first such tool in this list. When you’re writing your functions, I’m pretty sure that you add comments to it most of the time. You explain what the inputs are, what the outputs are going to be, and also how to use with a little example. Using <code>{fusen}</code> (and <code>{roxygen2}</code>), you simply continue doing the same, but with some added structure. This added structure is not costly to impose on yourself, and comes with many added benefits (in this case, free documentation!). I’m repeating myself but I really want to drive this point home: the goal is not to have to <em>add</em> code on top of what you already did. The point is to do what you always do, but within a framework.</p>
<p>Let’s now look at the functions’ <code>{roxygen2}</code>-type comments. The first line:</p>
<pre><code>#' get_raw_data Gets raw nominal house price data from LU Open Data Portal</code></pre>
<p>will create the title of the function’s help page. Then come the <code>@param</code> lines (in this case we only have one):</p>
<pre><code>#' @param url Optional: Persistent url to the data</code></pre>
<p>This lists the parameters of the function. Here you can explain exactly what the inputs should be. Suppose that the function has several parameters and that you forget to document one. If that happens, when you will inflate the file, you will get a warning in the console:</p>
<pre><code>inflate warnings and errors: Undocumented arguments in documentation 
object 'get_raw_data'
  'url'</code></pre>
<p>Then come the <code>@importFrom</code> statements. This is where you list dependencies:</p>
<pre><code>#' @importFrom readxl excel_sheets read_excel
#' @importFrom utils download.file
#' @importFrom dplyr mutate rename select
#' @importFrom stringr str_trim
#' @importFrom janitor clean_names
#' @importFrom purrr map_dfr</code></pre>
<p>This is important, because the statements will write the dependencies into the package’s <code>NAMESPACE</code> file. This file is important, because any function defined there will be available to your package’s functions when you load the package. So if your function use <code>dplyr::mutate()</code> for example, your package needs to know where to look for <code>mutate()</code>. This is where the <code>NAMESPACE</code> file comes into play. Take the opportunity to list the dependencies of your function to review them: maybe you’re using a package for a single dependency that you could easily remove. For example, I’m using <code>stringr::str_trim()</code> to remove whitespace around characters. But I could be using the base R function <code>trimws()</code> instead, which would remove this dependency. I’m going to keep it here, because I’m lazy though. It might seem like extra work to add these statements. But you have to see it this way: you are writing the functions here, once, that need to be available to your functions for them to work. The alternative is to have to write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readxl"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"utils"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"stringr"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"janitor"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"purrr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>on top of each script that uses your functions. This gets old pretty fast.</p>
<p>You will also notice the following <code>importFrom</code> statement:</p>
<pre><code>#' @importFrom utils download.file</code></pre>
<p><code>download.file()</code> is included in the <code>{utils}</code> package, itself included with a base installation of R. So you don’t really need to specify it; but when inflating the file, you get the following message:</p>
<pre><code>Consider adding
  importFrom("utils", "download.file")
to your NAMESPACE file.</code></pre>
<p>hence why I’ve added it, to silence this message. Again, not mandatory, but why not do it?</p>
<p>Now comes the <code>@return</code> keyword: this simply tells your users what the function returns. If the function doesn’t return anything, because it only has a side effect (for example, writing something to disk, or printing something on screen), then you could return <code>NULL</code>.</p>
<pre><code>#' @return A data frame</code></pre>
<p>Last but not least, the <code>@export</code> keyword:</p>
<pre><code>#' @export</code></pre>
<p>This makes the function available to users that load the package using <code>library(housing)</code>. If you don’t add this keyword, the function will be only available to the other functions of the package. Another way to see this: functions decorated with the <code>@export</code> keyword are public, functions without it are private. But private functions don’t really exist in R. You can always access a “private” function by using <code>:::</code> (three times the <code>:</code>), as in <code>package:::private_function()</code>.</p>
<p>The other functions are documented in the same manner, so I won’t comment them here. Something else you might have noticed: I replaced every <code>%&gt;%</code> by the base pipe <code>|&gt;</code>. You don’t have to do it, but the advantage of using the base pipe is that it removes the dependency on the <code>{magrittr}</code> package, needed for <code>%&gt;%</code>. If you want to use <code>%&gt;%</code>, you can keep it, but then should run the line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pipe</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>in the <code>0-dev_history.Rmd</code> file, which will take care of adding this dependency correctly for you (by editing the <code>NAMESPACE</code> file).</p>
<p>Next comes the test we wrote. As a reminder, here is how it looked like in our original <code>.Rmd</code> file:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>Let’s test to see if all the communes from our dataset are represented.</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>setdiff(flat_data$locality, communes)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The objects <code>communes</code> and <code>flat_data</code> have to obviously exist for this test to pass. This was a very simple test that must be monitored interactively. If commune names are returned here, then this means that there are communes left that we need to include in our data. But remember: we are aiming at building a RAP, and don’t want to have to look at it as it is running to see if everything is alright. What we need is a test that returns an error if it fails. So for this we use the <code>{testthat}</code> package, and write a so-called <em>unit test</em>. We’re going to deep-dive into unit testing (and assertive testing) in the next chapter, so for now, let me simply comment the test:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>```{r tests-clean_flat_data}</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a># We now need to check if we have them all in the data.</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a># The test needs to be self-contained, hence</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a># why we need to redefine the required variables:</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>former_communes &lt;- get_former_communes()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>current_communes &lt;- get_current_communes()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>communes &lt;- get_test_communes(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  former_communes,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  current_communes</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>raw_data &lt;- get_raw_data(url = "https://is.gd/1vvBAc")</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>flat_data &lt;- clean_raw_data(raw_data)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>testthat::expect_true(</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  all(communes %in% unique(flat_data$locality))</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The first thing that you need to know is that tests need to be self-contained. This is why we define <code>former_communes</code> and <code>current_communes</code> again. The reason is that <code>{fusen}</code> will take this whole chunk and save it inside a script in the package’s <code>tests/</code> folder. When executed, the test will run in a fresh session where the <code>communes</code> object is not defined. So that’s why you need to redefine every variable the test needs to run. For the test itself, we use <code>testthat::expect_true()</code>. This function expects a piece of code that should evaluate to <code>TRUE</code>: if not, we get an error, and the whole pipeline stops here, forcing us to see what’s going on. This is exactly what we want: when our code fails, it needs to fail as early and as spectacularly as possible. If you rely of future you to have to manually check console output or logs and look for errors, you deserve everything that’s going to happen to you.</p>
<p>Under the section titled “Functions used for analysis”, I copy and pasted the functions from the <code>analyse_data.Rmd</code> and documented them as well. What’s new is that I’ve added examples:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>```{r examples-get_laspeyeres, eval = FALSE}</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>#' \dontrun{</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>#' commune_level_data_laspeyeres &lt;- get_laspeyeres(commune_level_data)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>#' } </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But I don’t want these examples to run, simply to appear in the documentation. This is because, just like for tests, examples have to be self-contained. So for this example to run successfully, I would need to redefine <code>commune_level_data</code> from scratch. I don’t want to do this now, so hence why I wrapped the example around <code>\dontrun</code> and used roxygen-style comments with <code>#'</code>. I did the same with the function to plot the data.</p>
<p>We’re almost done; take a look again at the template <code>flat_minimal.Rmd</code>. I advised you to take inspiration from it to get <code>save_data.Rmd</code> fusen-ready. At the end of that file, we can see this chunk:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>```{r development-inflate, eval=FALSE}</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a># Run but keep eval=FALSE to avoid infinite loop</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a># Execute in the console directly</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>fusen::inflate(flat_file = "dev/flat_minimal.Rmd",</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>               vignette_name = "Minimal")</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This chunk contains the code that we need to run, manually, to inflate the package. However, I’ve removed it, and the reason is that I prefer to have it inside the <code>0-dev_history.Rmd</code> file. I think that it makes more sense to have it there. Take a look at my <code>0-dev_history.Rmd</code> <a href="https://is.gd/JsJJVN">here</a><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. By reading that file, you see all the different developer actions that were taken. Your team-mates, or future you could read this, and immediately understand what happened, and what was done. Under the section title “Inflate save_data.Rmd”, you see that the chunk to inflate the <code>.Rmd</code> file and generate the package is there. I can run this chunk from <code>0-dev_history.Rmd</code> and have my package successfully generated. Something important to notice as well: my fusen-ready <code>.Rmd</code> file is simply called <code>save_data.Rmd</code>, while the generated, inflated file, that will be part of the package under the <code>vignettes/</code> folder is called <code>dev-save_data.Rmd</code>.</p>
<p>I suggest that you stop here, and really try to get this working as well. You can start by simply cloning your fork of this <a href="https://github.com/b-rodrigues/housing">repository</a><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> I linked in the beginning of this chapter, and follow along. After inflating, take a look at the vignette generated from the inflated <code>dev-save_data.Rmd</code>, which you can find under the <code>vignettes/</code> folder. One thing you need to understand, is that the <code>save_data.Rmd</code> file that you inflate, under <code>dev/</code>, is a working file for <em>developers</em>. The generated vignette on the other hand, can be read by stakeholders other than developers as well. In my case, I’ve added the prefix <code>dev-</code> because this vignette deals with preparing data for including in the package, and there is not much point for a stakeholder other than a developer to read this vignette. You will notice that the generated vignette does not contain the function chunks. This is normal, because after inflating the <code>.Rmd</code> file, the functions get saved under the <code>R/</code> folder. Really take some time to understand this. Because what follows will assume that you have groked <code>{fusen}</code>.</p>
</section>
<section id="including-datasets" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="including-datasets"><span class="header-section-number">11.4</span> Including datasets</h2>
<p>Another difference between our initial <code>.Rmd</code> and the fusen-ready <code>.Rmd</code>, is that the fusen-ready <code>save_data.Rmd</code> file does not save the datasets as <code>.csv</code> files anymore. This is because it is much better to include them directly in the package, and make them available to users like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"commune_level_data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this however, we need the package to already be built; only once the package exists can we include data sets. This is why we need to inflate <code>save_data.Rmd</code> first. So, how do we include data sets in a package? If you are developing packages in the usual manner (meaning, without <code>{fusen}</code>) then you have to do the following steps:</p>
<ul>
<li>write a script that generates the data set (and save this script inside the <code>data-raw/</code> folder for future reference)</li>
<li>save the datasets inside the <code>data/</code> folder.</li>
</ul>
<p>But we are using <code>{fusen}</code>, so instead, we can use the documentation first approach! And actually, the first step is done already: we have our vignette <code>save_data.Rmd</code>! Let’s not forget that the whole point of <code>save_data.Rmd</code> file was, initially, to build these datasets and save them. So why not simply re-use this vignette? If you take a look at the inflated <code>dev-save_data.Rmd</code>, you will see that everything is right there! We have used it in the past to build our datasets, so of course everything is in there. So remember, we don’t want to have to repeat ourselves. The vignette is right there with the code we need, so we are going to use it.</p>
<p>If you look at <code>0-dev_history.Rmd</code>, everything is explained under the header “Including datasets”. The idea is to run the code inside the vignette, which creates our datasets, and then save these datasets in the right place using <code>usethis::use_data()</code>, mimicking the steps above. I wrapped all the code around the <code>local()</code> function to run all these steps inside a temporary, local environment. This way, any variable that gets made by knitting the vignette gets discarded once we’re done.</p>
<p>Finally, we need to document the datasets. For this, we use another <code>.Rmd</code> file that we inflate as well. You can find it under <code>dev/data_doc.Rmd</code>, or by clicking <a href="https://is.gd/wjkNAO">here</a><a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. Datasets get defined inside chunks, just like functions, using <code>{roxygen2}</code>-type comments.</p>
<p>This basically covers what you need to know to package code. Of course, there are many other topics that we could discuss, but for our purposes, this is enough. We now know how to take advantage of the tools that make package development easy, and have diverted them for our use. If you want to develop a proper package and push it to CRAN, then I highly recommend you read the <a href="https://r-pkgs.org/">second edition of <em>R packages</em></a><a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> by <span class="citation" data-cites="wickham2023">Wickham and Bryan (<a href="references.html#ref-wickham2023" role="doc-biblioref">2023</a>)</span>. This book goes into all the nitty gritty details of full package development. But let me be clear: this does not mean that you cannot develop a full, CRAN-ready, package using <code>{fusen}</code>. You absolutely can! It’s just that this is outside the scope of the present book.</p>
</section>
<section id="installing-and-sharing-the-package" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="installing-and-sharing-the-package"><span class="header-section-number">11.5</span> Installing and sharing the package</h2>
<p>To install the package on the same machine that you developed it, you can simply run the line <code>remotes::install_local()</code> on line 46 of the <code>0-dev_history.Rmd</code> file (ideally in a fresh R session). But how can you share it with colleagues or future you?</p>
<p>Now that the package is ready, you need to be able to share it. This really depends on whether you can publish the code on Github or not, or whether your company/institution has a self-hosted version control system. In this section, we’re going to discover the following two scenarios: the package is hosted on Github (or in a private self-hosted version control system), or the package cannot be hosted for whatever reason.</p>
<section id="code-is-hosted" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1" class="anchored" data-anchor-id="code-is-hosted"><span class="header-section-number">11.5.1</span> Code is hosted</h3>
<p>So if the code is hosted on Github (or on a self-hosted, private, version control system), users of the package can install it directly from Github. This can be done using the <code>{remotes}</code> package, like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"github_username/repository_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is also possible to install the package from a specific branch:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"github_username/repository_name@repo_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>it is even possible to install the package exactly how it was at a specific commit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"github_username/repository_name@repo_name"</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ref =</span> <span class="st">"commit_hash"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, if you want to install the package we have developed together from my Github account, you could run the following (the commit hash is actually wrong so you don’t install this one by mistake):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"rap4all/housing@fusen"</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ref =</span> <span class="st">"ae42601"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So the package in the <code>fusen</code> branch and at commit “ae42601” gets installed. Keep in mind that you can specify the commit hash to install the exact version you need, because this is going to do wonders for reproducibility.</p>
</section>
<section id="code-cannot-be-hosted" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2" class="anchored" data-anchor-id="code-cannot-be-hosted"><span class="header-section-number">11.5.2</span> Code cannot be hosted</h3>
<p>If the code cannot be hosted, then you have to share it <em>manually</em>. That’s less than ideal, but sometimes there simply is no alternative. In that case, you need to prepare a compressed archive that you can share. This is easily done using <code>devtools::build()</code>. Start a new session in the root directory of you package, and run <code>devtools::build()</code>. This will create a <code>.tar.gz</code> file that you can send to you team-mates, or archive for future you. Ideally, before creating this file, you should go to <code>0-dev_history.Rmd</code> and update the version number in the <code>fusen::fill_description()</code> function, like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fusen<span class="sc">::</span><span class="fu">fill_description</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pkg =</span> here<span class="sc">::</span><span class="fu">here</span>(),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fields =</span> <span class="fu">list</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Title =</span> <span class="st">"Housing Data For Luxembourg"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Version =</span> <span class="st">"0.1"</span>, <span class="co"># notice that I’ve added a version number here</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Description =</span> <span class="st">"This package contains functions to get,</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="st">                   clean and analyse housing price data for Luxembourg."</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Authors@R</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">person</span>(<span class="st">"Bruno"</span>, <span class="st">"Rodrigues"</span>, <span class="at">email =</span> <span class="st">"bruno@brodrigues.co"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">role =</span> <span class="fu">c</span>(<span class="st">"aut"</span>, <span class="st">"cre"</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">comment =</span> <span class="fu">c</span>(<span class="at">ORCID =</span> <span class="st">"0000-0002-3211-3689"</span>))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>) <span class="co"># you need to add overwrite = TRUE to overwrite the file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You have to be very disciplined here, because you have to make sure that you keep updating this and documenting which version of the package should get used for which project. Also, make sure that you can store generated <code>.tar.gz</code> alongside the project and that you provide clear installation instructions. To install a package from a <code>.tar.gz</code> file, open a new R session and run the following:</p>
<pre><code>remotes::install_local("path/to/package/housing_0.0.0.9000.tar.gz")</code></pre>
</section>
<section id="marketing-your-work" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3" class="anchored" data-anchor-id="marketing-your-work"><span class="header-section-number">11.5.3</span> Marketing your work</h3>
<p>Once your package is done, whether it is destined for CRAN or not, whether it can only be shared within your organisation or not, it is important to market it and make it discoverable. This is where building a website for the package is important, and thankfully, it but takes two lines of code to build a fully functioning site. In the introduction we built the website for the template included with <code>{fusen}</code>, let’s now build a website for our housing package.</p>
<p>This website can then be hosted online if you wish, or it can be shared internally to your organisation, offline, as a means of providing documentation.</p>
<p>Take a look at the very last section of the <code>0-dev_history.Rmd</code> file, titled “Share the package”. If you execute the lines in that chunk (ideally from a fresh R session), a website will be built automatically. This website will first be in the <code>docs/</code> folder: open the <code>index.html</code> file using a web-browser and you can start navigating the documentation!</p>
<p>If your package is on Github, you can also host the website for free on Github pages. For this, first make sure that the <code>.gitignore</code> file in the root of your package does not contain the <code>docs/</code> folder. If it does, remove it. Then, commit and push. This will upload the <code>docs/</code> package on Github. Then, go to the repository’s settings, and “Pages” and then choose the branch that contains the <code>docs/</code> folder:</p>
<figure class="figure">
<img src="images/pkgdown_deploy.png" alt="Choose these options to host your package’s website for free!" class="figure-img">
<figcaption class="figure-caption">
Choose these options to host your package’s website for free!
</figcaption>
</figure>
<p>As an example, you can visit the website of the package we’ve built together <a href="https://rap4all.github.io/housing/">here</a><a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>.</p>
<p>The package’s <code>README</code> will be shown, if available, on the starting page of the website. So if you want to add a <code>README</code> to your package, go to the <code>0-dev_history.Rmd</code> file and execute the line <code>usethis::use_readme_rmd()</code>, which adds a template <code>README</code> file in the root of your package. Regardless of whether you want to build a website, adding a <code>README</code> to it is always a good idea! You could explain what the main features of the package are, and how to install it, especially if you want your users or future you to install the package at a certain commit, it is quite useful to write it down clearly in the instructions. Something like:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>To install this package, run the following lines of code:</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>remotes::install_github("rap4all/housing@fusen",</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                        ref = "ae42601")</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="conclusion" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">11.6</span> Conclusion</h2>
<p>Turning our analysis into a package is useful, because we can divert a lot of tools that are originally intended for package development towards improving our analysis. We can now more easily document the code, define its dependencies, and also share it with teammates, our future selves or the world. What’s more, we clearly separate two tasks from each other: the pure software engineering part, which consisted in building the package, from the pure data analysis part, which will eventually become our pipeline.</p>
<p>There is one chapter left before we actually build a full-fledged pipeline. In the next chapter, we will learn how to use unit and assertive testing to further improve the code of our package, which will thus also improve the quality of our analysis.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-wickham2023" class="csl-entry" role="listitem">
Wickham, Hadley, and Jenny Bryan. 2023. <em>R Packages (2e)</em>. <a href="https://r-pkgs.org/">https://r-pkgs.org/</a>.
</div>
</div>
</section>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>https://is.gd/5pJi2h<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://is.gd/PfvkSZ<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://is.gd/PS45xu<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://is.gd/jGZrMF<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>https://is.gd/n3m6In<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>https://is.gd/n3m6In<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>https://is.gd/JsJJVN<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>https://is.gd/jGZrMF<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>https://is.gd/wjkNAO<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>https://r-pkgs.org/<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>https://rap4all.github.io/housing/<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./repro_intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Basic reproducibility: freezing packages</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./testing.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Testing your code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>